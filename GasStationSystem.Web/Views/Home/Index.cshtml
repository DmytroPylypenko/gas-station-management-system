@model IEnumerable<GasStationSystem.Web.Models.Product>

@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center mb-5">
    <h1 class="display-4 fw-bold">Welcome to GasStation</h1>
    <p class="lead">Select fuel or food to start your order</p>
</div>

<div class="row mb-4">
    <div class="col-12">
        <h3>⛽ Fuel</h3>
        <hr/>
    </div>
    @foreach (var item in Model.Where(p => p.Type == ProductType.Fuel))
    {
        <div class="col-md-3 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <img src="@item.ImageUrl" class="card-img-top" alt="@item.Name"
                     style="height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">@item.Name</h5>
                    <p class="card-text text-muted small">@item.Description</p>
                    <h4 class="text-primary fw-bold">@item.Price.ToString("C") <span class="fs-6 text-muted">/ L</span>
                    </h4>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <button onclick="addToCart(@item.Id, '@item.Name')" class="btn btn-outline-primary w-100">
                        <i class="fa-solid fa-gas-pump"></i> Choose
                    </button>
                </div>
            </div>
        </div>
    }
</div>

<div class="row">
    <div class="col-12">
        <h3>☕ Cafe & Food</h3>
        <hr/>
    </div>
    @foreach (var item in Model.Where(p => p.Type == ProductType.Food))
    {
        <div class="col-md-3 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <img src="@item.ImageUrl" class="card-img-top" alt="@item.Name"
                     style="height: 200px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">@item.Name</h5>
                    <p class="card-text text-muted small">@item.Description</p>
                    <h4 class="text-success fw-bold">@item.Price.ToString("C")</h4>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <button onclick="addToCart(@item.Id, '@item.Name')" class="btn btn-outline-success w-100">
                        <i class="fa-solid fa-cart-plus"></i> Add to Order
                    </button>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function addToCart(productId, productName) {
            $.ajax({
                url: '@Url.Action("AddToCart", "Cart")',
                type: 'POST',
                data: {id: productId},
                success: function (response) {
                    if (response.success) {
                        if (response.success) {
                            let badge = $("#cartBadge");
                            badge.text(response.count).show();
                            badge.animate({ opacity: 0.5 }, 100).animate({ opacity: 1 }, 100);
                        }
                        Swal.fire({
                            title: 'Added!',
                            text: productName + ' added to your cart.',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false,
                            toast: true,
                            position: 'top-end'
                        });
                    }
                },
                error: function () {
                    Swal.fire('Error', 'Could not add product to cart', 'error');
                }
            });
        }
    </script>
}